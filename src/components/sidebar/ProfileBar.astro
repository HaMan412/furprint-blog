---
import { USER_AVATAR, USER_SIDEBAR_SOCIAL_ICONS } from "../../config";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
---

<div class="relative p-5 flex flex-col items-center">
  <!-- Avatar with larger display -->
  <div class="w-full flex justify-center mb-3">
    <Image
      class="rounded-2xl w-full max-w-[200px] aspect-square object-cover shadow-lg"
      format="webp"
      width={200}
      height={200}
      src={USER_AVATAR}
      alt="Profile"
      loading="eager"
    />
  </div>

  <!-- Name -->
  <h2 class="text-2xl font-bold text-base-content mb-1.5">HaMan</h2>

  <!-- Bio/Stats -->
  <div class="flex items-center gap-2 text-sm text-base-content/70 mb-3">
    <span>Ciallo～(∠・ω&lt; )⌒☆</span>
  </div>

  <!-- Divider above social icons -->
  <div class="w-full border-t border-base-300 my-3"></div>

  <!-- Social Icons -->
  <div class="flex gap-3">
    {
      USER_SIDEBAR_SOCIAL_ICONS.map((icon) => (
        <div class="tooltip tooltip-bottom" data-tip={icon.title}>
          <a
            href={icon.href}
            aria-label={icon.ariaLabel}
            target="_blank"
            class="btn btn-circle btn-sm btn-ghost hover:btn-primary transition-all"
          >
            <Icon name={icon.svg} class="w-5 h-5" />
          </a>
        </div>
      ))
    }
  </div>

  <!-- Divider below social icons -->
  <div class="w-full border-t border-base-300 my-3"></div>

  <!-- Busuanzi Counter -->
  <div class="text-xs text-base-content/70 text-center">
    <span id="busuanzi_container_site_pv">已经被 <span id="busuanzi_value_site_pv"></span> 人发现了喵~</span>
  </div>
</div>

<script is:inline>
  // Load busuanzi script
  function loadBusuanzi() {
    // Remove old script if exists
    const oldScript = document.querySelector('script[src*="busuanzi"]');
    if (oldScript) {
      oldScript.remove();
    }

    // Load new script
    const script = document.createElement("script");
    script.async = true;
    script.src = "//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js";
    document.head.appendChild(script);
  }

  // Load on initial page load
  loadBusuanzi();

  // Reload on Astro page navigation
  document.addEventListener("astro:page-load", () => {
    loadBusuanzi();
  });
</script>
